#!/usr/bin/env bash

NAME=$(basename $1)
EXEC=@CMAKE_RUNTIME_OUTPUT_DIRECTORY@/$1
XML=@AVM_TEST_OUTPUT_DIR@/$NAME.xml
#PROFRAW=@AVM_COVERAGE_OUTPUT_DIR@/$NAME.profraw
#PROFDATA=@AVM_COVERAGE_OUTPUT_DIR@/$NAME.profdata

#LLVM_PROFILE_FILE=$PROFRAW
CMOCKA_XML_FILE=$XML $EXEC

if [ "@AVM_XUNIT_VIEWER_PROGRAM@" != "AVM_XUNIT_VIEWER_PROGRAM-NOTFOUND" ]; then
    @AVM_XUNIT_VIEWER_PROGRAM@ -r $XML -o @AVM_TEST_OUTPUT_DIR@/$NAME.html
fi

# llvm-profdata-10 merge -sparse $PROFRAW -o $PROFDATA
# llvm-cov-10 show --format=html $EXEC -instr-profile=$PROFDATA -o @AVM_COVERAGE_OUTPUT_DIR@/$NAME
